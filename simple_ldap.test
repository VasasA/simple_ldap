<?php
/**
 * @file
 * Tests for Simple LDAP module.
 */

class SimpleLdapServerWebTestCase extends DrupalWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'LDAP server connectivity',
      'description' => 'Tests the Simple LDAP server configuration and connectivity.',
      'group' => 'Simple LDAP',
    );
  }

  public function setUp() {
    parent::setUp(array('simple_ldap', 'simple_ldap_test'));
  }

  /**
   * Test the LDAP server configuration and connectivity.
   */
  public function testLdapServer() {
    // Initialize the LDAP server.
    $this->server = SimpleLdapServer::singleton();

    // Initialize t() params.
    $t = array(
      ':host' => $this->server->host,
      ':port' => $this->server->port,
      ':tls' => $this->server->starttls ? ' ' . t('using startTLS') : '',
      ':ssl' => strpos($this->server->host, 'ldaps://') === 0 ? ' ' . t('using SSL') : '',
    );

    // Test connectivity to the configured LDAP server.
    $this->assertTrue($this->server->bind(), t('Successfully bound to :host on port :port:tls:ssl.', $t));
    $this->assertTrue($this->server->unbind(), t('Successfully unbound from :host.', $t));
  }

}
