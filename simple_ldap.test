<?php
/**
 * @file
 * Tests for Simple LDAP module.
 */

abstract class SimpleLdapWebTestCase extends DrupalWebTestCase {

  public function setUp() {
    parent::setUp(array('simple_ldap', 'simple_ldap_test'));
    simple_ldap_test_config();
  }

}

class SimpleLdapServerWebTestCase extends SimpleLdapWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'LDAP server connectivity',
      'description' => 'Tests the Simple LDAP server configuration and connectivity.',
      'group' => 'Simple LDAP',
    );
  }

  /**
   * Test the LDAP server configuration and connectivity.
   */
  public function testLdapServer() {
    // Test that simple_ldap is configured.
    $this->assertTrue(simple_ldap_configured(), t('The Simple LDAP module is configured.'));

    // Initialize the LDAP server.
    $this->server = SimpleLdapServer::singleton();

    // Test connectivity to the configured LDAP server.
    $this->assertTrue($this->server->bind(), t('Successfully bound to the LDAP server.'));
    $this->assertTrue($this->server->unbind(), t('Successfully unbound from the LDAP server.'));
  }

}
